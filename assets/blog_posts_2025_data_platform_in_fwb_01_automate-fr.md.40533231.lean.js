import{_ as o,H as l,o as t,c as r,S as s,J as a}from"./chunks/framework.ad705b6b.js";const B=JSON.parse('{"title":"Plateforme de donn√©es - Partie 2 : Automatiser tout ü§ñ","description":"","frontmatter":{"date":"2025-07-03T00:00:00.000Z","title":"Plateforme de donn√©es - Partie 2 : Automatiser tout ü§ñ","sidebar":false,"author":"Martin Erpicum","category":"Article","tags":["data","orchestrator"],"blog":"post","aside":"left","prev":false,"next":false},"headers":[],"relativePath":"blog/posts/2025/data_platform_in_fwb_01_automate-fr.md"}'),p={name:"blog/posts/2025/data_platform_in_fwb_01_automate-fr.md"};function i(c,e,d,u,m,y){const n=l("ImageCenter");return t(),r("div",null,[e[0]||(e[0]=s('<p><em>R√©sum√© ex√©cutif</em> : Dans une organisation polyc√©phale, la Gouvernance des Donn√©es est un d√©fi complexe. Cet article explore la mise en ≈ìuvre d&#39;une Plateforme de Donn√©es bas√©e sur <a href="https://dagster.io/" target="_blank" rel="noreferrer">Dagster</a> pour la <a href="https://www.federation-wallonie-bruxelles.be" target="_blank" rel="noreferrer">F√©d√©ration Wallonie-Bruxelles (FWB)</a>. Il met en √©vidence l&#39;importance de l&#39;automatisation, de la modularit√© et de la r√©utilisabilit√© des composants pour abaisser la barri√®re technique et am√©liorer la litt√©ratie des donn√©es parmi les analystes de donn√©es et les gestionnaires de donn√©es.</p><hr><p><em>Les opinions exprim√©es sur ce site web sont les miennes et ne refl√®tent pas n√©cessairement celles de mon employeur.</em></p><p><strong>Table des mati√®res</strong></p><nav class="table-of-contents"><ul><li><a href="#üèóÔ∏è-architecture-technique-de-notre-plateforme-de-donnees">üèóÔ∏è Architecture technique de notre plateforme de donn√©es</a><ul><li><a href="#structure-des-emplacements-de-code">Structure des emplacements de code</a></li></ul></li><li><a href="#ü§ñ-automatiser-le-ci-cd">ü§ñ Automatiser le CI/CD</a><ul><li><a href="#flux-ci-cd">Flux CI/CD</a></li><li><a href="#etapes-ci-cd-de-notre-plateforme-de-donnees">√âtapes CI/CD de notre plateforme de donn√©es</a></li><li><a href="#specificites-des-environnements">Sp√©cificit√©s des environnements</a></li></ul></li><li><a href="#ü§ñ-automatiser-les-tests">ü§ñ Automatiser les tests</a></li><li><a href="#üöÄ-automatiser-le-deploiement">üöÄ Automatiser le d√©ploiement</a><ul><li><a href="#cycle-de-deploiement-de-notre-plateforme-de-donnees">Cycle de d√©ploiement de notre plateforme de donn√©es</a></li><li><a href="#cycle-de-deploiement-de-nos-projets-dbt">Cycle de d√©ploiement de nos projets DBT</a></li></ul></li><li><a href="#üëÄ-automatiser-l-observabilite">üëÄ Automatiser l&#39;observabilit√©</a><ul><li><a href="#observabilite-de-notre-pile-conteneurs">Observabilit√© de notre pile (conteneurs)</a></li><li><a href="#observabilite-de-nos-pipelines-de-donnees">Observabilit√© de nos pipelines de donn√©es</a></li><li><a href="#observabilite-de-nos-donnees">Observabilit√© de nos donn√©es</a></li></ul></li></ul></nav><p>Si vous souhaitez encourager les analystes de donn√©es et les gestionnaires de donn√©es √† participer au d√©veloppement de pipelines de donn√©es, vous devez vous assurer que chaque commit est test√© et valid√© avant d&#39;√™tre d√©ploy√© en production. Vous voulez √©galement automatiser les t√¢ches r√©p√©titives pour r√©duire la barri√®re technique autant que possible. De plus, vous voulez mettre en place un syst√®me d&#39;observabilit√© solide pour surveiller la sant√© de vos syst√®mes et pipelines de donn√©es et d√©tecter les probl√®mes rapidement.</p><p>Pour expliquer comment nous automatisons le d√©ploiement des pipelines de donn√©es, je vais d&#39;abord d√©crire l&#39;architecture de notre plateforme de donn√©es.</p><h2 id="üèóÔ∏è-architecture-technique-de-notre-plateforme-de-donnees" tabindex="-1">üèóÔ∏è Architecture technique de notre plateforme de donn√©es <a class="header-anchor" href="#üèóÔ∏è-architecture-technique-de-notre-plateforme-de-donnees" aria-label="Permalink to &quot;üèóÔ∏è Architecture technique de notre plateforme de donn√©es&quot;">‚Äã</a></h2><p>Notre pile est actuellement bas√©e sur les composants suivants :</p><ul><li><strong>Dagster</strong> : L&#39;orchestrateur de nos pipelines de donn√©es. Il nous permet de d√©finir, planifier et surveiller nos workflows de donn√©es.</li><li><strong>dbt-core</strong> : L&#39;outil de transformation de donn√©es qui nous permet de d√©finir nos mod√®les et transformations de donn√©es de mani√®re modulaire. Il est utilis√© pour construire les mod√®les et transformations de donn√©es qui sont ex√©cut√©s par Dagster.</li><li><strong>DuckDB</strong> : Le moteur SQL qui nous permet d&#39;ex√©cuter des requ√™tes SQL sur nos donn√©es. Il est utilis√© pour le d√©veloppement et les tests locaux de nos pipelines de donn√©es.</li><li><strong>Azure</strong> : Le fournisseur cloud qui h√©berge notre plateforme de donn√©es. Nous utilisons Azure Data Lake Storage (ADLS) pour le stockage des donn√©es.</li><li><strong>Docker</strong> : La technologie de conteneurisation qui nous permet d&#39;empaqueter nos pipelines de donn√©es et leurs d√©pendances de mani√®re portable.</li><li><strong>GitLab</strong> : Le syst√®me de contr√¥le de version qui nous permet de g√©rer nos d√©p√¥ts de code et d&#39;automatiser nos pipelines CI/CD.</li></ul>',10)),a(n,{src:"https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/diagrams/data_platform.drawio.png",alt:"Flux de donn√©es dans notre pile",width:"600"}),e[1]||(e[1]=s(`<p>Une remarque importante ici : nos choix techniques ne sont pas grav√©s dans le marbre. Nous √©valuons constamment de nouvelles technologies et approches pour am√©liorer notre plateforme de donn√©es. L&#39;objectif est de fournir une architecture flexible et √©volutive qui peut s&#39;adapter aux besoins changeants de l&#39;organisation. Si <code>dbt-core</code>, <code>Dagster</code>, ou tout autre outil/fournisseur ne r√©pond plus √† nos besoins, nous n&#39;h√©siterons pas √† le changer. Ce √† quoi nous nous engageons vraiment, c&#39;est l&#39;(1) <strong>architecture</strong>, et les (2) <strong>langages</strong> que nous utilisons pour l&#39;impl√©menter (Python, SQL). Les outils et fournisseurs ne sont que des moyens pour atteindre un objectif.</p><p>Pour d&#39;excellentes recommandations sur la fa√ßon de construire une plateforme de donn√©es solide, je recommande de lire <a href="https://www.oreilly.com/library/view/fundamentals-of-data/9781098108298/" target="_blank" rel="noreferrer">Fundamentals of Data Engineering</a> de Joe Reis et Matt Housley.</p><h3 id="structure-des-emplacements-de-code" tabindex="-1">Structure des emplacements de code <a class="header-anchor" href="#structure-des-emplacements-de-code" aria-label="Permalink to &quot;Structure des emplacements de code&quot;">‚Äã</a></h3><p>Pour permettre √† chaque administration g√©n√©rale (AG) de poss√©der son propre d√©p√¥t (un <strong>code location</strong> dans le vocabulaire Dagster)‚Äîqui contient l&#39;emplacement de code Dagster pour les pipelines de donn√©es de cette AG‚Äînous avons d√©cid√© de <strong>refl√©ter la structure organisationnelle de la FWB dans l&#39;architecture de notre plateforme de donn√©es</strong>. Nous utilisons √©galement des emplacements de code distincts pour des projets sp√©cifiques qui ne sont pas li√©s √† une AG sp√©cifique. Cela permet √† chaque AG de g√©rer ses propres pipelines de donn√©es de mani√®re ind√©pendante et d&#39;avoir une propri√©t√© claire du code. Les emplacements de code sont ensuite agr√©g√©s dans une seule instance Dagster, qui est la plateforme de donn√©es.</p><h4 id="üóÇÔ∏è-structure-de-notre-dossier-d-emplacements-de-code" tabindex="-1">üóÇÔ∏è Structure de notre dossier d&#39;emplacements de code <a class="header-anchor" href="#üóÇÔ∏è-structure-de-notre-dossier-d-emplacements-de-code" aria-label="Permalink to &quot;üóÇÔ∏è Structure de notre dossier d&#39;emplacements de code&quot;">‚Äã</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">dagster_home</span><span style="color:#BABED8;"> (main) $ tree -L 1</span></span>
<span class="line"><span style="color:#82AAFF;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">‚îú‚îÄ‚îÄ</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ags_project</span></span>
<span class="line"><span style="color:#FFCB6B;">‚îú‚îÄ‚îÄ</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">agaj_project</span></span>
<span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#FFCB6B;">‚îú‚îÄ‚îÄ</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">data_platform</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># notre emplacement de code g√©n√©rique</span></span>
<span class="line"><span style="color:#FFCB6B;">‚îú‚îÄ‚îÄ</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dagster.yaml</span></span>
<span class="line"><span style="color:#FFCB6B;">‚îî‚îÄ‚îÄ</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">workspace.yaml</span></span></code></pre></div><h2 id="ü§ñ-automatiser-le-ci-cd" tabindex="-1">ü§ñ Automatiser le CI/CD <a class="header-anchor" href="#ü§ñ-automatiser-le-ci-cd" aria-label="Permalink to &quot;ü§ñ Automatiser le CI/CD&quot;">‚Äã</a></h2><h3 id="flux-ci-cd" tabindex="-1">Flux CI/CD <a class="header-anchor" href="#flux-ci-cd" aria-label="Permalink to &quot;Flux CI/CD&quot;">‚Äã</a></h3><p>Notre configuration de d√©ploiement est bas√©e sur les pipelines GitLab CI/CD. Le flux est le suivant :</p><ol start="0"><li><strong>Int√©gration des sous-modules</strong> : Les projets DBT sont int√©gr√©s comme un sous-module Git dans le d√©p√¥t principal. Cela nous permet d&#39;inclure le travail des gestionnaires de donn√©es et des analystes dans la plateforme de donn√©es sans avoir √† dupliquer le code ou √† maintenir des d√©p√¥ts s√©par√©s.</li><li><strong>Build</strong> : Le code est construit et empaquet√© dans une image Docker ; la m√™me image est utilis√©e pour le Webserver, le Daemon et les emplacements de code.</li><li><strong>Valider les d√©finitions</strong> : Les d√©finitions Dagster sont valid√©es pour s&#39;assurer qu&#39;elles sont correctes et ne contiennent aucune erreur.</li><li><strong>Ruff</strong> : Le code est v√©rifi√© pour les probl√®mes de style et de formatage √† l&#39;aide de <a href="https://docs.astral.sh/ruff/" target="_blank" rel="noreferrer">Ruff</a>.</li><li><strong>Sonar</strong> : Le code est analys√© pour les probl√®mes de qualit√© et de s√©curit√© √† l&#39;aide de <a href="https://www.sonarqube.org/" target="_blank" rel="noreferrer">SonarQube</a>.</li><li><strong>Test</strong> : Le code est test√© √† l&#39;aide de <a href="https://docs.pytest.org/en/stable/" target="_blank" rel="noreferrer">pytest</a> pour les tests unitaires, les tests d&#39;int√©gration et l&#39;analyse de couverture.</li><li><strong>D√©ployer en DEV</strong> : Le code est d√©ploy√© dans l&#39;environnement de d√©veloppement pour chaque commit dans la branche principale ou une branche de fonctionnalit√©.</li><li><strong>D√©ployer en STAGING</strong> : Lorsqu&#39;un tag est cr√©√©, le code est d√©ploy√© dans l&#39;environnement de staging.</li><li><strong>D√©ployer en PROD</strong> : Le code est d√©ploy√© dans l&#39;environnement de production apr√®s validation manuelle en staging.</li></ol><h3 id="etapes-ci-cd-de-notre-plateforme-de-donnees" tabindex="-1">√âtapes CI/CD de notre plateforme de donn√©es <a class="header-anchor" href="#etapes-ci-cd-de-notre-plateforme-de-donnees" aria-label="Permalink to &quot;√âtapes CI/CD de notre plateforme de donn√©es&quot;">‚Äã</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;"># .gitlab-ci.yml (simplifi√©)</span></span>
<span class="line has-focus"><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">docker compose build</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">validate</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dagster definitions validate -m data_platform</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">test</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">pytest -v</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C3E88D;">--cov=. --cov-branch --cov-report=html --cov-report=term</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C3E88D;">--cov-report xml:coverage.xml</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C3E88D;">--junitxml=report.xml</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">ruff</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ruff check --output-format=gitlab .</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">sonarqube-check</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">test</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">sonar-scanner</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">deploy_dev</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">deploy</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">only</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">docker compose up -d</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">deploy_staging</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">deploy</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">only</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">tags</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">docker compose up -d</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">deploy_prod</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">deploy</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">when</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">manual</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">only</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">tags</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">docker compose up -d</span></span></code></pre></div><h3 id="specificites-des-environnements" tabindex="-1">Sp√©cificit√©s des environnements <a class="header-anchor" href="#specificites-des-environnements" aria-label="Permalink to &quot;Sp√©cificit√©s des environnements&quot;">‚Äã</a></h3><p>Les environnements sont configur√©s dans le fichier <code>docker-compose.yml</code> √† l&#39;aide de variables d&#39;environnement. Chaque environnement a ses propres variables d&#39;environnement, qui sont utilis√©es pour configurer le comportement de la plateforme de donn√©es.</p><p>Nous utilisons un seul fichier <code>docker-compose.yml</code> dont le contenu peut √™tre adapt√© en fonction de l&#39;environnement. Le fichier compose contient tous les services n√©cessaires pour ex√©cuter la plateforme de donn√©es, y compris le webserver Dagster, le daemon Dagster et les emplacements de code Dagster.</p><p>Dans l&#39;exemple suivant, nous montrons comment nous utilisons le m√™me fichier compose pour d√©ployer la plateforme de donn√©es dans diff√©rents environnements en utilisant uniquement des variables d&#39;environnement :</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># docker-compose.yml (simplifi√©)</span></span>
<span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.8</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">dagster_webserver</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">.</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${DOCKER_IMAGE}:\${CI_COMMIT_SHORT_SHA}</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">restart</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">unless-stopped</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">env_file</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">.env</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ENVIRONMENT=\${ENVIRONMENT}</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># staging, prod</span></span></code></pre></div><h2 id="ü§ñ-automatiser-les-tests" tabindex="-1">ü§ñ Automatiser les tests <a class="header-anchor" href="#ü§ñ-automatiser-les-tests" aria-label="Permalink to &quot;ü§ñ Automatiser les tests&quot;">‚Äã</a></h2><p>Tous nos tests sont impl√©ment√©s en Python √† l&#39;aide de <code>pytest</code>. Nous couvrons les tests unitaires, les tests d&#39;int√©gration et l&#39;analyse de couverture. Cependant, nous testons g√©n√©ralement seulement les parties critiques de notre code, telles que les d√©finitions Dagster, les ressources personnalis√©es, le code Python et le parsing DBT. Nous ne testons g√©n√©ralement pas les requ√™tes SQL √† moins qu&#39;elles ne contiennent une logique complexe.</p><h2 id="üöÄ-automatiser-le-deploiement" tabindex="-1">üöÄ Automatiser le d√©ploiement <a class="header-anchor" href="#üöÄ-automatiser-le-deploiement" aria-label="Permalink to &quot;üöÄ Automatiser le d√©ploiement&quot;">‚Äã</a></h2><h3 id="cycle-de-deploiement-de-notre-plateforme-de-donnees" tabindex="-1">Cycle de d√©ploiement de notre plateforme de donn√©es <a class="header-anchor" href="#cycle-de-deploiement-de-notre-plateforme-de-donnees" aria-label="Permalink to &quot;Cycle de d√©ploiement de notre plateforme de donn√©es&quot;">‚Äã</a></h3><p>Le cycle de d√©ploiement de notre plateforme de donn√©es consiste en les √©tapes suivantes :</p><ol start="0"><li>D√©veloppement local ‚Üí un d√©veloppeur travaille sur une nouvelle fonctionnalit√© dans son environnement local.</li><li>Commit ‚Üí le d√©veloppeur valide ses modifications dans la branche principale ou une branche de fonctionnalit√©.</li><li>Build ‚Üí GitLab CI/CD construit le code et l&#39;empaquette dans une image Docker.</li><li>Test ‚Üí GitLab CI/CD ex√©cute les tests et g√©n√®re un rapport de couverture.</li><li>D√©ployer en DEV ‚Üí GitLab CI/CD d√©ploie le code dans l&#39;environnement de d√©veloppement.</li><li>Tag de version ‚Üí lorsque le d√©veloppeur est satisfait des modifications, il cr√©e un tag de version.</li><li>D√©ployer en STAGING ‚Üí GitLab CI/CD d√©ploie le code dans l&#39;environnement de staging.</li><li>D√©ployer en PROD ‚Üí Apr√®s validation en staging, GitLab CI/CD d√©ploie le code dans l&#39;environnement de production.</li></ol>`,23)),a(n,{src:"https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/diagrams/dagster_code_location_cycle.drawio.png",alt:"Cycle de d√©ploiement de l'emplacement de code Dagster",width:"600"}),e[2]||(e[2]=s(`<h3 id="cycle-de-deploiement-de-nos-projets-dbt" tabindex="-1">Cycle de d√©ploiement de nos projets DBT <a class="header-anchor" href="#cycle-de-deploiement-de-nos-projets-dbt" aria-label="Permalink to &quot;Cycle de d√©ploiement de nos projets DBT&quot;">‚Äã</a></h3><p>Lorsqu&#39;une nouvelle version est cr√©√©e, le projet DBT est automatiquement versionn√© √† l&#39;aide de l&#39;outil <code>release</code>. La version est incr√©ment√©e et un changelog est g√©n√©r√©. Le projet DBT est ensuite analys√© √† l&#39;aide de <code>dbt parse</code> pour produire le fichier <code>manifest.json</code>, qui contient les m√©tadonn√©es du projet DBT. Ce fichier est utilis√© par Dagster pour d√©couvrir les mod√®les DBT et leurs d√©pendances.</p><h4 id="le-cycle-de-version-de-nos-projets-dbt-consiste-en-les-etapes-suivantes" tabindex="-1">Le cycle de version de nos projets DBT consiste en les √©tapes suivantes : <a class="header-anchor" href="#le-cycle-de-version-de-nos-projets-dbt-consiste-en-les-etapes-suivantes" aria-label="Permalink to &quot;Le cycle de version de nos projets DBT consiste en les √©tapes suivantes :&quot;">‚Äã</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight has-focused-lines has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;"># .gitlab-ci.yml</span></span>
<span class="line has-focus"><span style="color:#F07178;">sqlfluff</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">allow_failure</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">sqlfluff lint models</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">release</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">VERSION=$(release next-version)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">      sed -i &quot;s/version: \\&quot;[^\\&quot;]*\\&quot;/version: \\&quot;$VERSION\\&quot;/&quot; &quot;$FILETOCHANGE&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">release changelog</span></span>
<span class="line has-focus"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">release commit-and-tag --create-tag-pipeline CHANGELOG.md \${DBT_PATH}/dbt_project.yml</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F07178;">dagster_submodule</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">if</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">$CI_COMMIT_TAG</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">...</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">git add .</span></span>
<span class="line has-focus"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">git diff --cached --quiet || git commit -m &quot;Update dbt submodule&quot;</span><span style="color:#BABED8;">  </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;"># Pousser les modifications sans forcer la suppression</span></span>
<span class="line has-focus"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">git push origin dagster_submodule</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Cette √©tape publie un artefact pour la documentation DBT.</span></span>
<span class="line has-focus"><span style="color:#F07178;">pages</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dbt_docs</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">only</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">...</span><span style="color:#89DDFF;">]</span></span>
<span class="line has-focus"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dbt docs generate</span><span style="color:#BABED8;"> </span></span></code></pre></div><h2 id="üëÄ-automatiser-l-observabilite" tabindex="-1">üëÄ Automatiser l&#39;observabilit√© <a class="header-anchor" href="#üëÄ-automatiser-l-observabilite" aria-label="Permalink to &quot;üëÄ Automatiser l&#39;observabilit√©&quot;">‚Äã</a></h2><p>L&#39;observabilit√© de notre plateforme de donn√©es est un aspect cl√© de la mise en ≈ìuvre d&#39;une Plateforme de Donn√©es. Elle nous permet de surveiller la sant√© de nos syst√®mes (1) et de nos pipelines de donn√©es (2), de d√©tecter les probl√®mes rapidement et d&#39;assurer la qualit√© de nos donn√©es (3).</p>`,6)),a(n,{src:"https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/images/ms-team-panopticon.png",alt:"Panopticon",width:"600"}),e[3]||(e[3]=s('<h3 id="observabilite-de-notre-pile-conteneurs" tabindex="-1">Observabilit√© de notre pile (conteneurs) <a class="header-anchor" href="#observabilite-de-notre-pile-conteneurs" aria-label="Permalink to &quot;Observabilit√© de notre pile (conteneurs)&quot;">‚Äã</a></h3><p>Pour l&#39;observabilit√© de nos syst√®mes, nous utilisons <a href="https://www.elastic.co/kibana" target="_blank" rel="noreferrer">Kibana</a> et <a href="https://dozzle.dev/" target="_blank" rel="noreferrer">Dozzle</a> pour surveiller les journaux et les m√©triques de notre plateforme de donn√©es.</p><h3 id="observabilite-de-nos-pipelines-de-donnees" tabindex="-1">Observabilit√© de nos pipelines de donn√©es <a class="header-anchor" href="#observabilite-de-nos-pipelines-de-donnees" aria-label="Permalink to &quot;Observabilit√© de nos pipelines de donn√©es&quot;">‚Äã</a></h3><p>Comme un <a href="https://fr.wikipedia.org/wiki/Panoptique" target="_blank" rel="noreferrer">panopticon</a> ou un <strong>hub d&#39;observabilit√© centralis√©</strong>, nous utilisons principalement un canal MS Teams (accessible par toutes les parties prenantes) pour centraliser l&#39;observabilit√© de notre plateforme de donn√©es en un seul endroit. Certaines notifications personnalis√©es sont √©galement envoy√©es via NTFY et Email pour des √©v√©nements ou alertes sp√©cifiques.</p><h3 id="observabilite-de-nos-donnees" tabindex="-1">Observabilit√© de nos donn√©es <a class="header-anchor" href="#observabilite-de-nos-donnees" aria-label="Permalink to &quot;Observabilit√© de nos donn√©es&quot;">‚Äã</a></h3><p>Pour l&#39;observabilit√© de nos donn√©es, nous utilisons les fonctionnalit√©s int√©gr√©es de Dagster pour v√©rifier la qualit√© de nos donn√©es. Dagster fournit un ensemble de fonctionnalit√©s d&#39;observabilit√© (personnalis√©es ou int√©gr√©es) qui nous permettent de surveiller la sant√© de nos pipelines de donn√©es et de d√©tecter les probl√®mes rapidement.</p><p>M√™me sans √©crire de v√©rifications personnalis√©es, l&#39;interface utilisateur de Dagster nous permet de surveiller la qualit√© de nos donn√©es. Voici comment nous avons trouv√© un probl√®me de qualit√© dans l&#39;un de nos pipelines de donn√©es :</p>',7)),a(n,{src:"https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/images/dagster_asset_quality.png",alt:"Comment la fonctionnalit√© d'observabilit√© nous a aid√©s √† d√©tecter des probl√®mes de qualit√©",width:"600"}),e[4]||(e[4]=s('<hr><p>Dans cet article, nous avons explor√© comment automatiser le d√©ploiement de pipelines de donn√©es dans une organisation polyc√©phale comme la FWB. Nous avons vu comment utiliser Dagster comme orchestrateur, dbt-core pour les transformations de donn√©es, et GitLab CI/CD pour automatiser le processus de d√©ploiement.</p><p>Nous avons √©galement discut√© de l&#39;importance de la <strong>modularit√©</strong> et de la <strong>r√©utilisabilit√©</strong> des composants pour abaisser la barri√®re technique pour les analystes de donn√©es et les gestionnaires de donn√©es. En automatisant le processus de d√©ploiement, nous pouvons nous assurer que chaque commit est test√© et valid√© avant d&#39;√™tre d√©ploy√© en production, ce qui encourage la participation des analystes de donn√©es et des gestionnaires de donn√©es dans le d√©veloppement de pipelines de donn√©es.</p><p>Mais comme indiqu√© dans l&#39;introduction, le <strong>niveau de participation est inversement proportionnel √† la barri√®re technique</strong>. Plus la configuration est complexe, moins les analystes de donn√©es et les gestionnaires de donn√©es sont susceptibles de participer au d√©veloppement de pipelines de donn√©es.</p><p>Dans le prochain article, nous explorerons comment abaisser encore davantage la barri√®re technique en fournissant des ressources conviviales pour que les professionnels des donn√©es interagissent avec la plateforme de donn√©es. Nous discuterons √©galement de la fa√ßon d&#39;am√©liorer la litt√©ratie des donn√©es parmi les analystes de donn√©es et les gestionnaires de donn√©es pour les encourager √† participer au d√©veloppement de pipelines de donn√©es.</p><ul><li><a href="/blog/posts/2025/data_platform_in_fwb_02_lower_barrier-fr.html">Partie 3 : Comment les ressources personnalis√©es et la formation aident √† abaisser la barri√®re</a></li></ul>',6))])}const F=o(p,[["render",i]]);export{B as __pageData,F as default};
