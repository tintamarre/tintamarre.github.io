import{_ as l,H as t,o as e,c as p,S as n,J as o}from"./chunks/framework.f141d1be.js";const E=JSON.parse('{"title":"Address lookup - Part 2b: Messing around","description":"","frontmatter":{"date":"2024-12-03T00:00:00.000Z","title":"Address lookup - Part 2b: Messing around","sidebar":false,"author":"Martin Erpicum","category":"Exploration","tags":["data","exploration"],"blog":"post","aside":"left","prev":false,"next":false},"headers":[],"relativePath":"blog/posts/2024/address_lookup-part2b-messing-around.md"}'),r={name:"blog/posts/2024/address_lookup-part2b-messing-around.md"};function c(i,s,y,B,A,d){const a=t("ImageCenter");return e(),p("div",null,[s[0]||(s[0]=n(`<p><em>Executive summary</em>: In Belgium, a collaborative effort between regional and federal authorities has led to the creation of a unified service that aggregates all Belgian addresses into a comprehensive dataset. This dataset is called <a href="https://bosa.belgium.be/fr/services/best-address-services" target="_blank" rel="noreferrer">BeStAddress</a>.</p><hr><h1 id="address-lookup-part-2b-messing-around" tabindex="-1">Address lookup - Part 2b: Messing around <a class="header-anchor" href="#address-lookup-part-2b-messing-around" aria-label="Permalink to &quot;Address lookup - Part 2b: Messing around&quot;">​</a></h1><p>This post is a continuation of the <a href="/blog/posts/2024/address_lookup-part2-sourcing.html">previous post</a> where we have analyzed the data model of the BeStAddress dataset.</p><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>In Belgium, each municipality is responsible for naming its streets. <a href="https://www.ibz.rrn.fgov.be/fileadmin/user_upload/fr/rn/circulaires/BeSt_20201104_F.pdf" target="_blank" rel="noreferrer">Although it is recommended to avoid similar street names</a>, this can sometimes result in two streets within the same municipality having very similar names. In this post, we will explore the <strong>BeStAddress dataset</strong> to identify pairs of streets with similar names that are geographically close to each other.</p><p>To analyse this, we will use the <a href="/blog/posts/2024/address_lookup-part2-sourcing.html">unified table that aggregates all the data from the different regions of Belgium</a> to find pairs of streets with similar names that are close to each other.</p><p>We will proceed in three steps:</p><ol><li>Find the average latitude and longitude of each street in each municipality.</li><li>Calculate the distance between each pair of streets in the same municipality.</li><li>Calculate the Levenshtein distance between the street names of each pair of streets.</li></ol><h2 id="step-1-find-the-average-latitude-and-longitude-of-street-in-each-municipality" tabindex="-1">Step 1: Find the average latitude and longitude of street in each municipality <a class="header-anchor" href="#step-1-find-the-average-latitude-and-longitude-of-street-in-each-municipality" aria-label="Permalink to &quot;Step 1: Find the average latitude and longitude of street in each municipality&quot;">​</a></h2><p>This step will allow us to identify the geographical center of each street in the dataset and then use this information to calculate the distance between pairs of streets.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> averages_by_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">             street_id,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">  )</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets</span></span></code></pre></div><h2 id="step-2-distance-calculation" tabindex="-1">Step 2. Distance Calculation <a class="header-anchor" href="#step-2-distance-calculation" aria-label="Permalink to &quot;Step 2. Distance Calculation&quot;">​</a></h2><p>We will calculate the distance between each pair of streets in the same municipality. We will use the <strong>Haversine formula</strong> to calculate the distance between two points on the Earth&#39;s surface given their latitude and longitude.</p><p>After calculating the distance between each pair of streets, we will filter the results to only include pairs of streets that are less than 5 kilometers apart.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> averages_by_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">             street_id,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> postcode </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">4140</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">-- Filter by municipality_id == Sprimont</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">  ),</span></span>
<span class="line"><span style="color:#BABED8;">combination_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon1,</span></span>
<span class="line"><span style="color:#BABED8;">           b.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets a</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CROSS JOIN</span><span style="color:#BABED8;"> averages_by_streets b</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id, a.street_id) </span><span style="color:#89DDFF;">&lt;&gt;</span><span style="color:#BABED8;"> (b.municipality_id, b.street_id) </span><span style="color:#676E95;font-style:italic;">-- Exclude self-joins</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.municipality_id</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.street_id)</span></span>
<span class="line"><span style="color:#BABED8;">        )  </span><span style="color:#676E95;font-style:italic;">-- Ensure unique pairs</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">distance_calculation </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_2,</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- Haversine Formula</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- 6371 is the radius of the Earth in kilometers</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- RADIANS converts degrees to radians</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">6371</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ASIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SQRT</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lat1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat1)) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2)) </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lon2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lon1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">))) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> combination_streets</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(distance_km, </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> distance_calculation</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> distance_km </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">5</span><span style="color:#BABED8;">;</span></span></code></pre></div><h2 id="step-3-levenshtein-distance-calculation" tabindex="-1">Step 3. Levenshtein Distance Calculation <a class="header-anchor" href="#step-3-levenshtein-distance-calculation" aria-label="Permalink to &quot;Step 3. Levenshtein Distance Calculation&quot;">​</a></h2><p>Finally, we will calculate the Levenshtein distance between the street names of each pair of streets. The Levenshtein distance is a measure of the similarity between two strings. It is defined as the minimum number of single-character edits (insertions, deletions, or substitutions) required to change one string into the other.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> averages_by_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">             street_id,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> postcode </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">4140</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">-- Filter by municipality_id == Sprimont</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">  ),</span></span>
<span class="line"><span style="color:#BABED8;">unique_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id,</span></span>
<span class="line"><span style="color:#BABED8;">           default_streetname</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> street_id </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> street_id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> municipality_id </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> ALL</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">combination_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon1,</span></span>
<span class="line"><span style="color:#BABED8;">           b.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets a</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CROSS JOIN</span><span style="color:#BABED8;"> averages_by_streets b</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id, a.street_id) </span><span style="color:#89DDFF;">&lt;&gt;</span><span style="color:#BABED8;"> (b.municipality_id, b.street_id) </span><span style="color:#676E95;font-style:italic;">-- Exclude self-joins</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.municipality_id</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.street_id)</span></span>
<span class="line"><span style="color:#BABED8;">        )  </span><span style="color:#676E95;font-style:italic;">-- Ensure unique pairs</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">distance_calculation </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_2,</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- Haversine Formula</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- 6371 is the radius of the Earth in kilometers</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- RADIANS converts degrees to radians</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">6371</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ASIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SQRT</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lat1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat1)) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2)) </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lon2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lon1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">))) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> combination_streets</span></span>
<span class="line"><span style="color:#BABED8;">), combination_with_distances_filtered </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(distance_km, </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> distance_calculation</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> distance_km </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">levenstein_distance </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">    street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">    street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">    distance_km,</span></span>
<span class="line"><span style="color:#BABED8;">    a.default_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> streetname_1,</span></span>
<span class="line"><span style="color:#BABED8;">    b.default_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> streetname_2,</span></span>
<span class="line"><span style="color:#BABED8;">    levenshtein(a.default_streetname, b.default_streetname) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> levenshtein_distance</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> combination_with_distances_filtered</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> unique_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> a</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> municipality_id_1</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> street_id_1</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> unique_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> b</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> municipality_id_2</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> b.street_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> street_id_2</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> levenstein_distance</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> levenshtein_distance </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> levenshtein_distance </span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#BABED8;"> levenshtein_distance, distance_km;</span></span></code></pre></div><p>That&#39;s it! We have successfully identified pairs of streets with similar names that are geographically close to each other. It is a long query, but it is very powerful and can be used to identify potential issues with street names in the BeStAddress dataset.</p><h2 id="results" tabindex="-1">Results <a class="header-anchor" href="#results" aria-label="Permalink to &quot;Results&quot;">​</a></h2><table><thead><tr><th style="text-align:right;">municipality_id_1</th><th style="text-align:right;">street_id_1</th><th style="text-align:right;">municipality_id_2</th><th style="text-align:right;">street_id_2</th><th style="text-align:right;">distance_km</th><th>streetname_1</th><th>streetname_2</th><th style="text-align:right;">levenshtein_distance</th></tr></thead><tbody><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732983</td><td style="text-align:right;">62100</td><td style="text-align:right;">7732991</td><td style="text-align:right;">4.16</td><td>Rue de Damré</td><td>Rue de Gomzé</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732996</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733018</td><td style="text-align:right;">2.53</td><td>Rue de la Carrière</td><td>Rue de la Sablière</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733062</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733067</td><td style="text-align:right;">0.63</td><td>Rue des Fawes</td><td>Rue des Marets</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733110</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733117</td><td style="text-align:right;">3.48</td><td>Rue du Roua</td><td>Rue du Voué</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732981</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733047</td><td style="text-align:right;">4.02</td><td>Rue de Coreux</td><td>Rue de Theux</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732981</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733042</td><td style="text-align:right;">1.13</td><td>Rue de Coreux</td><td>Rue de Rouvreux</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732961</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733129</td><td style="text-align:right;">0.27</td><td>Rue Basse Lillé</td><td>Rue Haute Lillé</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733092</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733108</td><td style="text-align:right;">4.55</td><td>Rue du Coq</td><td>Rue du Pont</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733105</td><td style="text-align:right;">62100</td><td style="text-align:right;">7762862</td><td style="text-align:right;">0.33</td><td>Rue du Pahy</td><td>Rue du Parc</td><td style="text-align:right;">2</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733124</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733132</td><td style="text-align:right;">4.37</td><td>Rue Ferreuse</td><td>Rue Houreuse</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733123</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733124</td><td style="text-align:right;">3.9</td><td>Rue Ferrer</td><td>Rue Ferreuse</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733081</td><td style="text-align:right;">62100</td><td style="text-align:right;">7762862</td><td style="text-align:right;">2.6</td><td>Rue du Baron</td><td>Rue du Parc</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733083</td><td style="text-align:right;">62100</td><td style="text-align:right;">7762862</td><td style="text-align:right;">1.66</td><td>Rue du Baty</td><td>Rue du Parc</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733083</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733105</td><td style="text-align:right;">1.99</td><td>Rue du Baty</td><td>Rue du Pahy</td><td style="text-align:right;">2</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733081</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733083</td><td style="text-align:right;">3.85</td><td>Rue du Baron</td><td>Rue du Baty</td><td style="text-align:right;">3</td></tr></tbody></table><h2 id="further-exploration" tabindex="-1">Further exploration <a class="header-anchor" href="#further-exploration" aria-label="Permalink to &quot;Further exploration&quot;">​</a></h2>`,23)),o(a,{src:"https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExZTZ6NW5nbXU2Z3hudGszMDljM3lodjR3bHJyZ3Zva3VvZTF5Z3ZqYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/KEXq9JVp3OyZmxZw0W/giphy.gif",alt:"Further exploration",width:"800"}),s[1]||(s[1]=n(`<p>The BeStAddress dataset offers numerous opportunities for interesting analyses beyond just finding similar street names. Let&#39;s explore some additional queries that can help us understand the dataset better and potentially identify areas for improvement in address management.</p><h3 id="_1-mapping-street-relationships-within-municipalities" tabindex="-1">1. Mapping Street Relationships Within Municipalities <a class="header-anchor" href="#_1-mapping-street-relationships-within-municipalities" aria-label="Permalink to &quot;1. Mapping Street Relationships Within Municipalities&quot;">​</a></h3><p>When working with addresses, it&#39;s often useful to understand how streets are distributed within municipalities. This query helps us identify all unique pairs of streets within each municipality, which can be valuable for:</p><ul><li>Urban planning analysis</li><li>Understanding street network connectivity</li><li>Identifying potential naming conflicts</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">        municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">        street_id,</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">avg</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude, </span><span style="color:#676E95;font-style:italic;">-- Round to 3 decimal places (= ~110 meters)</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">avg</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">        bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">GROUP BY</span></span>
<span class="line"><span style="color:#BABED8;">        municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">    a.municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">    a.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> first_street_id,</span></span>
<span class="line"><span style="color:#BABED8;">    b.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> second_street_id,</span></span>
<span class="line"><span style="color:#BABED8;">    a.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> first_street_latitude,</span></span>
<span class="line"><span style="color:#BABED8;">    a.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> first_street_longitude,</span></span>
<span class="line"><span style="color:#BABED8;">    b.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> second_street_latitude,</span></span>
<span class="line"><span style="color:#BABED8;">    b.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> second_street_longitude</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">    DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> a</span></span>
<span class="line"><span style="color:#F78C6C;">JOIN</span></span>
<span class="line"><span style="color:#BABED8;">    DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> b</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#676E95;font-style:italic;">-- Same municipality</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.street_id </span><span style="color:#676E95;font-style:italic;">-- Ensure different street ids and avoid duplicate combinations</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span></span>
<span class="line"><span style="color:#BABED8;">    a.municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">    a.street_id,</span></span>
<span class="line"><span style="color:#BABED8;">    b.street_id</span></span>
<span class="line"><span style="color:#F78C6C;">LIMIT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">;</span></span></code></pre></div><p>The query uses a self-join technique to pair each street with every other street in the same municipality, while avoiding duplicate combinations. We round the coordinates to 3 decimal places (~110 meters precision) to simplify the data while maintaining meaningful geographical precision.</p><h3 id="_2-analyzing-multilingual-street-name-coverage" tabindex="-1">2. Analyzing Multilingual Street Name Coverage <a class="header-anchor" href="#_2-analyzing-multilingual-street-name-coverage" aria-label="Permalink to &quot;2. Analyzing Multilingual Street Name Coverage&quot;">​</a></h3><p>Belgium&#39;s multilingual nature makes it essential to understand how well street names are documented in different languages. This query analyzes the completeness of street names across French, Dutch, and German:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F78C6C;">DISTINCT</span><span style="color:#BABED8;"> municipality_id, street_id, streetname_fr, streetname_de, streetname_nl</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">        BestAddress</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> total_streets,</span></span>
<span class="line"><span style="color:#BABED8;">    (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_fr </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_fr,</span></span>
<span class="line"><span style="color:#BABED8;">    (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_de </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_de,</span></span>
<span class="line"><span style="color:#BABED8;">    (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_nl </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_nl</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">    DistinctStreets</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id;</span></span></code></pre></div><p>This query provides insights into:</p><ul><li>The completeness of multilingual street naming</li><li>Potential gaps in language coverage</li><li>Areas that might need attention for complete multilingual support</li></ul><h3 id="_3-identifying-language-border-municipalities" tabindex="-1">3. Identifying Language Border Municipalities <a class="header-anchor" href="#_3-identifying-language-border-municipalities" aria-label="Permalink to &quot;3. Identifying Language Border Municipalities&quot;">​</a></h3><p>Perhaps the most interesting analysis is finding municipalities that lie on language borders. These can be identified by looking for municipalities where street names aren&#39;t consistently available in all languages:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F78C6C;">DISTINCT</span><span style="color:#BABED8;"> municipality_id, street_id, streetname_fr, streetname_de, streetname_nl, region_code</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">          BestAddress</span></span>
<span class="line"><span style="color:#BABED8;">  )</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">      municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">      region_code,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> total_streets,</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_fr </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_fr,</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_de </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_de,</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_nl </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_nl</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">      DistinctStreets</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">GROUP BY</span></span>
<span class="line"><span style="color:#BABED8;">      municipality_id, region_code</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">HAVING</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_fr </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_de </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_nl </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">ORDER BY</span></span>
<span class="line"><span style="color:#BABED8;">      region_code;</span></span></code></pre></div><p>This advanced query helps identify:</p><ul><li>Municipalities on language borders</li><li>Areas with mixed language usage</li><li>Potential inconsistencies in multilingual street naming</li></ul><p>The HAVING clause specifically looks for municipalities where the percentage of street names in any language is neither 0% nor 100%, indicating mixed language usage. This can be particularly useful for:</p><ul><li>Understanding linguistic diversity in different regions</li><li>Planning multilingual signage requirements</li><li>Ensuring proper address documentation in all relevant languages</li></ul>`,18))])}const C=l(r,[["render",c]]);export{E as __pageData,C as default};
