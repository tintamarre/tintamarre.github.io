<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title></title>
        <link>localhost/blog</link>
        <description>Some thoughts</description>
        <lastBuildDate>Wed, 30 Oct 2024 16:06:18 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Tax brackets proposition]]></title>
            <link>localhost/blog/blog/posts/2024/tax_brackets_proposition.html</link>
            <guid>localhost/blog/blog/posts/2024/tax_brackets_proposition.html</guid>
            <pubDate>Sun, 27 Oct 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[<p><strong>Executive summary</strong>: The Belgian tax system is notably intricate, characterized by numerous tax brackets that determine the tax liability based on an individual's income. We take a look at the proposed changes to the tax brackets proposed by Bart De Wever in the latest version of the Super Nota (202410).</p>
]]></description>
            <content:encoded><![CDATA[<p><strong>Executive summary</strong>: The Belgian tax system is notably intricate, characterized by numerous tax brackets that determine the tax liability based on an individual's income. We take a look at the proposed changes to the tax brackets proposed by Bart De Wever in the latest version of the Super Nota (202410).</p>
<hr>
<h1 id="tax-brackets-proposition" tabindex="-1">Tax brackets proposition <a class="header-anchor" href="#tax-brackets-proposition" aria-label="Permalink to &quot;Tax brackets proposition&quot;">&ZeroWidthSpace;</a></h1>
<h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">&ZeroWidthSpace;</a></h2>
<p>The Belgian tax system is notably intricate, characterized by numerous tax brackets that determine the tax liability based on an individual's income.</p>
<p>In the latest version of the <a href="https://www.lecho.be/monargent/analyse/impots/ce-que-prevoit-la-nouvelle-super-note-de-bart-de-wever-pour-votre-argent/10569902.html" target="_blank" rel="noreferrer">Super Nota of Bart De Wever</a>, a proposal has been introduced to revise these tax brackets.</p>
<p>This analysis aims to provide a clearer understanding of the proposed changes to the tax brackets.</p>
<h2 id="results" tabindex="-1">Results <a class="header-anchor" href="#results" aria-label="Permalink to &quot;Results&quot;">&ZeroWidthSpace;</a></h2>
<p><img src="https://github.com/tintamarre/tax_brakets_belgium/blob/main/imposition.png?raw=true" alt="Tax brackets"></p>
<p><em>As observed, the changes are quite significant. Each income decile will experience a reduction in the tax rate. The most substantial tax decrease will benefit those earning 20k euros annually (+4.7%) and those earning above 65k euros, with a reduction of &gt; +4.7%.</em></p>
<h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">&ZeroWidthSpace;</a></h2>
<ul>
<li><a href="https://github.com/tintamarre/tax_brakets_belgium/blob/main/imposition.py" target="_blank" rel="noreferrer">Tax brackets proposition source code</a></li>
<li><a href="https://www.lecho.be/monargent/analyse/impots/ce-que-prevoit-la-nouvelle-super-note-de-bart-de-wever-pour-votre-argent/10569902.html" target="_blank" rel="noreferrer">L'ECHO : Ce que prévoit la nouvelle &quot;super note&quot; de Bart De Wever pour votre argent</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Address lookup - Part 1 - Analysis]]></title>
            <link>localhost/blog/blog/posts/2024/address_lookup-part1-problematic.html</link>
            <guid>localhost/blog/blog/posts/2024/address_lookup-part1-problematic.html</guid>
            <pubDate>Thu, 03 Oct 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[<p><em>Executive summary</em>: In Belgium, a collaborative effort between regional and federal authorities has led to the creation of a unified service that aggregates all Belgian addresses into a comprehensive dataset. This dataset is called <a href="https://bosa.belgium.be/fr/services/best-address-services" target="_blank" rel="noreferrer">BeStAddress</a>.</p>
]]></description>
            <content:encoded><![CDATA[<p><em>Executive summary</em>: In Belgium, a collaborative effort between regional and federal authorities has led to the creation of a unified service that aggregates all Belgian addresses into a comprehensive dataset. This dataset is called <a href="https://bosa.belgium.be/fr/services/best-address-services" target="_blank" rel="noreferrer">BeStAddress</a>.</p>
<hr>
<h1 id="address-lookup-analysis-1" tabindex="-1">Address lookup - Analysis (1) <a class="header-anchor" href="#address-lookup-analysis-1" aria-label="Permalink to &quot;Address lookup - Analysis (1)&quot;">&ZeroWidthSpace;</a></h1>
<h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">&ZeroWidthSpace;</a></h2>
<p>This article outlines an experiment conducted by the <strong>Data Office</strong> of the <strong>Ministère de la Fédération Wallonie-Bruxelles</strong> aimed at leveraging existing address datasets more effectively.</p>
<p>The primary objective is to optimize the process of looking up addresses by postal codes, street names, and house numbers within these datasets, and eventually matching them with the <strong>BeStAddress</strong> dataset.</p>
<p>In Belgium, a collaborative initiative led by <strong>BOSA</strong>, in partnership with regional and federal authorities, resulted in the creation of a unified service that consolidates all Belgian addresses into a single, comprehensive dataset known as <a href="https://bosa.belgium.be/fr/services/best-address-services" target="_blank" rel="noreferrer">BeStAddress</a>.</p>
<h2 id="quick-overview-of-bestaddress" tabindex="-1">Quick overview of BeStAddress <a class="header-anchor" href="#quick-overview-of-bestaddress" aria-label="Permalink to &quot;Quick overview of BeStAddress&quot;">&ZeroWidthSpace;</a></h2>
<p>At first glance, the dataset appears to be quite comprehensive, providing a wealth of information on addresses in Belgium. Key data points include:</p>
<ul>
<li><strong>Municipality names</strong> in French, Dutch, and German</li>
<li><strong>Postnames</strong> in French, Dutch, and German: In Belgium, postnames are used to identify specific zones within a municipality or across parts of one or several municipalities (further details on this will be provided later).</li>
<li><strong>Street names</strong> in French, Dutch, and German (often available in only one language depending on the region)</li>
<li><strong>Postcodes</strong></li>
<li><strong>House numbers</strong></li>
<li><strong>Box numbers</strong></li>
</ul>
<h3 id="example-of-a-single-record-as-json" tabindex="-1">Example of a single record (as JSON): <a class="header-anchor" href="#example-of-a-single-record-as-json" aria-label="Permalink to &quot;Example of a single record (as JSON):&quot;">&ZeroWidthSpace;</a></h3>
<div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">status</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">streetname_fr</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Rue de la Loi</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">streetname_de</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">null,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">streetname_nl</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Wetstraat</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">house_number</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">16</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">box_number</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">null,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">postcode</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">1000</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">municipality_name_fr</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Bruxelles</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">municipality_name_de</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">null,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">municipality_name_nl</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Brussel</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">postname_fr</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Bruxelles (Centre)</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">postname_nl</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Brussel (Centrum)</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">region_code</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">BE-BRU</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">municipality_id</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">21004</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">street_id</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1679</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">address_id</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">210225</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">EPSG:4326_lat</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">50.84616</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">EPSG:4326_lon</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">4.36653</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">EPSG:31370_x</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">148303.0</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&quot;</span><span style="color: #C792EA">EPSG:31370_y</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">:</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">169017.0</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
</div><h3 id="summarize-the-datasets" tabindex="-1">Summarize the datasets <a class="header-anchor" href="#summarize-the-datasets" aria-label="Permalink to &quot;Summarize the datasets&quot;">&ZeroWidthSpace;</a></h3>
<p>Based on the export from BOSA website of the dataset in flat format (gzipped CSV) of the 2024-09-23, the dataset contains <strong>6 608 518 records</strong> of status = <code>current</code>.</p>
<p>Here are summaries of each column in each dataset:</p>
<ul>
<li><a href="https://github.com/tintamarre/tintamarre.github.io/blob/master/src/assets/datasets/bestaddress_bxl.md" target="_blank" rel="noreferrer">Brussels (Bruxelles) dataset summary</a></li>
<li><a href="https://github.com/tintamarre/tintamarre.github.io/blob/master/src/assets/datasets/bestaddress_vld.md" target="_blank" rel="noreferrer">Flanders (Vlaanderen) dataset summary</a></li>
<li><a href="https://github.com/tintamarre/tintamarre.github.io/blob/master/src/assets/datasets/bestaddress_wal.md" target="_blank" rel="noreferrer">Wallonia (Wallonie) dataset summary</a></li>
</ul>
<p>As we can see, the dataset contains a lot of fields. It is also multilingual, which seems obivious for an official dataset in Belgium (where French, Dutch and German are <a href="https://www.belgium.be/en/about_belgium/government/federale_staat" target="_blank" rel="noreferrer">the official languages</a>). It also contains some <strong>specific identifiers</strong> such as:</p>
<ul>
<li><code>municipality_id</code> (unique identifier for each municipality is equal to the <a href="https://en.wikipedia.org/wiki/NIS_code" target="_blank" rel="noreferrer">NIS codes</a>)</li>
<li><code>street_id</code></li>
<li><code>address_id</code></li>
</ul>
<h2 id="checking-uniqueness-of-the-identifiers" tabindex="-1">Checking uniqueness of the identifiers <a class="header-anchor" href="#checking-uniqueness-of-the-identifiers" aria-label="Permalink to &quot;Checking uniqueness of the identifiers&quot;">&ZeroWidthSpace;</a></h2>
<p>The first step is to check the uniqueness of the identifiers in the dataset. We will check if the <code>street_id</code>, <code>municipality_id</code>, and <code>address_id</code> are unique.</p>
<p>Let's write a query that will count per region the number of unique <code>street_id</code>, <code>municipality_id</code>, and <code>address_id</code> and the total number of records. If the sum of the unique counts is equal to the total number of records, it means that the identifiers are unique in the dataset.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">BE-BRU</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> municipality_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> street_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_BRU</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">UNION ALL</span></span>
<span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">BE-WAL</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> municipality_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> street_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_WAL</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">UNION ALL</span></span>
<span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">BE-VLG</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> municipality_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> street_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_VLG</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">UNION ALL</span></span>
<span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8">  </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">TOTAL</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> municipality_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> street_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress;</span></span></code></pre>
</div><h3 id="results" tabindex="-1">Results <a class="header-anchor" href="#results" aria-label="Permalink to &quot;Results&quot;">&ZeroWidthSpace;</a></h3>
<table>
<thead>
<tr>
<th>region_code</th>
<th style="text-align:right">municipality_id_count</th>
<th style="text-align:right">street_id_count</th>
<th style="text-align:right">address_id_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>BE-BRU</td>
<td style="text-align:right">19</td>
<td style="text-align:right">5095</td>
<td style="text-align:right">790713</td>
</tr>
<tr>
<td>BE-WAL</td>
<td style="text-align:right">262</td>
<td style="text-align:right">57707</td>
<td style="text-align:right">1983442</td>
</tr>
<tr>
<td>BE-VLG</td>
<td style="text-align:right">300</td>
<td style="text-align:right">80354</td>
<td style="text-align:right">3834363</td>
</tr>
<tr>
<td>TOTAL</td>
<td style="text-align:right">581</td>
<td style="text-align:right">138457</td>
<td style="text-align:right">4203561</td>
</tr>
<tr>
<td>SUM = TOTAL</td>
<td style="text-align:right"><strong>ok!</strong></td>
<td style="text-align:right"><strong>nope</strong></td>
<td style="text-align:right"><strong>nope</strong></td>
</tr>
</tbody>
</table>
<ul>
<li>The <code>municipality_id</code> is unique in the dataset, which is mean that a municipality is unique in each region and is not shared between regions. This is expected as the <code>municipality_id</code> is equal to the <a href="https://en.wikipedia.org/wiki/NIS_code" target="_blank" rel="noreferrer">NIS codes</a>. The municipalities have a political and administrative meaning and are unique in each region.</li>
<li>The <code>street_id</code> shows that a street can be shared between multiple municipalities. This is not surprising as some streets can cross multiple municipalities.</li>
<li>The <code>address_id</code> is not unique throughout the three datasets, but it is probably unique in each dataset.</li>
</ul>
<p>Let's check the uniqueness of the <code>address_id</code> in each dataset.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">BE-BRU</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> total_row_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_BRU</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">UNION ALL</span></span>
<span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">BE-WAL</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> total_row_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_WAL</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">UNION ALL</span></span>
<span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">BE-VLG</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> total_row_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_VLG</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">UNION ALL</span></span>
<span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">TOTAL</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> region_code,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_id_count,</span></span>
<span class="line"><span style="color: #BABED8">        </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> total_row_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress;</span></span></code></pre>
</div><table>
<thead>
<tr>
<th>region_code</th>
<th style="text-align:right">address_id_count</th>
<th style="text-align:right">total_row_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>BE-BRU</td>
<td style="text-align:right">790713</td>
<td style="text-align:right">790713</td>
</tr>
<tr>
<td>BE-WAL</td>
<td style="text-align:right">1983442</td>
<td style="text-align:right">1983442</td>
</tr>
<tr>
<td>BE-VLG</td>
<td style="text-align:right">3834363</td>
<td style="text-align:right">3834363</td>
</tr>
<tr>
<td>TOTAL</td>
<td style="text-align:right">4203561</td>
<td style="text-align:right">6608518</td>
</tr>
</tbody>
</table>
<p>Indeed the <code>address_id</code> is unique in each dataset but is not unique throughout the three datasets.</p>
<h2 id="understanding-the-data-structure-deep-dive" tabindex="-1">Understanding the data structure - Deep dive <a class="header-anchor" href="#understanding-the-data-structure-deep-dive" aria-label="Permalink to &quot;Understanding the data structure - Deep dive&quot;">&ZeroWidthSpace;</a></h2>
<p>At first glance, we could think from the variables that a <strong>postcode</strong> include 1 or more municipalities and each municipality include 1 or more streets.</p>
<p>The model could simply be something like this:</p>
<ImageCenter src="https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/diagrams/best_address_simple_model.drawio.png" alt="best address wrong model" width="800" /><p>Let's check the data to see if this is true.</p>
<p>In some cases, a street can be shared between 2 municipalities. This is the case for example of the street <strong>Rue de la Loi</strong> which is in postcodes <code>['1000', '1012', '1040','1045', '1049']</code> for status_code = 'BE-BRU'.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span></span>
<span class="line"><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8">(postcode)</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_bxl</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">=</span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> street_id </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1679</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span></code></pre>
</div><p>On the other hand, a <code>municipality_id</code> can belong to multiple postcodes.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span></span>
<span class="line"><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8">(postcode)</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_bxl</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> municipality_id </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">21004</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">-- Bruxelles</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span></code></pre>
</div><p>This will return 14 distincts postcodes: <code>['1047', '1010', '1045', '1030', '1070', '1000', '1020', '1012', '1130', '1040', '1050', '1120', '1007', '1049']</code>.</p>
<p>In reverse, a postcode can have multiple <code>municipality_id</code> values.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span></span>
<span class="line"><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8">(municipality_id)</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_bxl</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">=</span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> postcode </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">1050</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">-- Ixelles</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span></code></pre>
</div><p>This will return 3 distincts <code>municipality_id</code>: <code>['21009', '21013', '21004']</code>.</p>
<p>Finally, a street with the same name, could have multiple <code>street_id</code> and <code>municipality_id</code> even within the same postcode. This is the case for example of the street <strong><code>Avenue Louise</code></strong>.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span></span>
<span class="line"><span style="color: #BABED8">municipality_id,</span></span>
<span class="line"><span style="color: #BABED8">street_id,</span></span>
<span class="line"><span style="color: #BABED8">postcode</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress_BRU</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> streetname_fr </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">Avenue Louise</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">status</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">current</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"><span style="color: #F78C6C">GROUP BY</span><span style="color: #BABED8"> all;</span></span></code></pre>
</div><table>
<thead>
<tr>
<th style="text-align:right">municipality_id</th>
<th style="text-align:right">street_id</th>
<th>postcode</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">21004</td>
<td style="text-align:right">1858</td>
<td>1050</td>
</tr>
<tr>
<td style="text-align:right">21009</td>
<td style="text-align:right">3919</td>
<td>1050</td>
</tr>
<tr>
<td style="text-align:right">21013</td>
<td style="text-align:right">751</td>
<td>1060</td>
</tr>
</tbody>
</table>
<h2 id="global-overview" tabindex="-1">Global overview <a class="header-anchor" href="#global-overview" aria-label="Permalink to &quot;Global overview&quot;">&ZeroWidthSpace;</a></h2>
<p>To better understand the relationships between the different entities in the dataset, we can perform some checks to see if there are any <strong>many-to-many</strong> relationships between the entities.</p>
<ImageCenter src="https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/diagrams/best_address_postcode_vs_municipality.drawio.png" alt="Let's check the data" width="800" /><h3 id="_1-checking-if-a-postcode-belongs-to-multiple-municipality-id-values" tabindex="-1">1. Checking if a postcode belongs to multiple <code>municipality_id</code> values <a class="header-anchor" href="#_1-checking-if-a-postcode-belongs-to-multiple-municipality-id-values" aria-label="Permalink to &quot;1. Checking if a postcode belongs to multiple `municipality_id` values&quot;">&ZeroWidthSpace;</a></h3>
<p>To check if a postcode is associated with multiple <code>municipality_id</code> values, you can group by the postcode and count distinct <code>municipality_id</code> values. If a postcode has more than 1 unique municipality_id, it means that the postcode is associated with multiple municipalities.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> postcode,</span></span>
<span class="line"><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> municipality_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress</span></span>
<span class="line"><span style="color: #F78C6C">GROUP BY</span><span style="color: #BABED8"> postcode</span></span>
<span class="line"><span style="color: #F78C6C">HAVING</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span></code></pre>
</div><table>
<thead>
<tr>
<th>postcode</th>
<th style="text-align:right">municipality_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>4910</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td>1050</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td>1030</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td>1070</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td>1040</td>
<td style="text-align:right">2</td>
</tr>
</tbody>
</table>
<p>This query will return all postcodes that are associated with more than one <code>municipality_id</code>. We only get 5 postcodes that are associated with multiple municipalities.</p>
<h3 id="_2-checking-if-a-municipality-id-belongs-to-multiple-postcode-values" tabindex="-1">2. Checking if a <code>municipality_id</code> belongs to multiple postcode values <a class="header-anchor" href="#_2-checking-if-a-municipality-id-belongs-to-multiple-postcode-values" aria-label="Permalink to &quot;2. Checking if a `municipality_id` belongs to multiple postcode values&quot;">&ZeroWidthSpace;</a></h3>
<p>Similarly, to check if a <code>municipality_id</code> is associated with multiple postcode values, group by <code>municipality_id</code> and count distinct postcode values. If a <code>municipality_id</code> has more than 1 unique postcode, it means that the <code>municipality_id</code> is associated with multiple postcodes.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> municipality_id,</span></span>
<span class="line"><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> postcode) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> postcode_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress</span></span>
<span class="line"><span style="color: #F78C6C">GROUP BY</span><span style="color: #BABED8"> municipality_id</span></span>
<span class="line"><span style="color: #F78C6C">HAVING</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> postcode) </span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span></code></pre>
</div><table>
<thead>
<tr>
<th style="text-align:right">municipality_id</th>
<th style="text-align:right">postcode_count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">73042</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">11002</td>
<td style="text-align:right">14</td>
</tr>
<tr>
<td style="text-align:right">...</td>
<td style="text-align:right">...</td>
</tr>
</tbody>
</table>
<p>This query will return all <strong>municipality_id</strong> that are associated with more than one postcode. We have a 221 <strong>municipality_id</strong> that are associated with multiple postcodes. Only the first ones are shown here.</p>
<p>The relationship between postcodes and municipalities is then a <strong>many-to-many relationship</strong>.</p>
<h3 id="_3-checking-if-a-street-id-belongs-to-multiple-municipality-id-values" tabindex="-1">3. Checking if a <code>street_id</code> belongs to multiple <code>municipality_id</code> values <a class="header-anchor" href="#_3-checking-if-a-street-id-belongs-to-multiple-municipality-id-values" aria-label="Permalink to &quot;3. Checking if a `street_id` belongs to multiple `municipality_id` values&quot;">&ZeroWidthSpace;</a></h3>
<p>To check if a street is associated with multiple municipalities, you can group by the <code>street_id</code> and count distinct <code>municipality_id</code> values. If a street has more than 1 unique municipality_id, it means that the street is associated with multiple municipalities.</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span><span style="color: #BABED8"> concat_ws(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">-</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">,region_code, street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> unique_street,</span></span>
<span class="line"><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> municipality_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress</span></span>
<span class="line"><span style="color: #F78C6C">GROUP BY</span><span style="color: #BABED8"> concat_ws(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">-</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">,region_code, street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> unique_street</span></span>
<span class="line"><span style="color: #F78C6C">HAVING</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> municipality_id) </span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span></code></pre>
</div><p>This query will return all street_ids in the same region that are associated with more than one <code>municipality_id</code>. We have <strong>15</strong> street_id that are associated with more than one municipality_id.</p>
<h3 id="_4-checking-if-a-street-id-can-have-multiple-postname-values" tabindex="-1">4. Checking if a <code>street_id</code> can have multiple <code>postname_*</code> values <a class="header-anchor" href="#_4-checking-if-a-street-id-can-have-multiple-postname-values" aria-label="Permalink to &quot;4. Checking if a `street_id` can have multiple `postname_*` values&quot;">&ZeroWidthSpace;</a></h3>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span></span>
<span class="line"><span style="color: #BABED8">concat_ws(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">-</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">,municipality_id, street_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> unique_street,</span></span>
<span class="line"><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> concat_ws(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D"> / </span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, postname_fr, postname_nl)) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> postname_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress</span></span>
<span class="line"><span style="color: #F78C6C">GROUP BY</span><span style="color: #BABED8"> all</span></span>
<span class="line"><span style="color: #F78C6C">HAVING</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8"> default_postname) </span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span></code></pre>
</div><p>This query will return all unique streets that are associated with more than one <code>postname_*</code> values. We have 3104 unique streets that are associated with more than one <code>postname_*</code> values.</p>
<p>Example of a street with multiple postnames:</p>
<div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #F78C6C">SELECT</span></span>
<span class="line"><span style="color: #F78C6C">DISTINCT</span><span style="color: #BABED8">(default_postname),</span></span>
<span class="line"><span style="color: #82AAFF">COUNT</span><span style="color: #BABED8">(address_id) </span><span style="color: #F78C6C">AS</span><span style="color: #BABED8"> address_count</span></span>
<span class="line"><span style="color: #F78C6C">FROM</span><span style="color: #BABED8"> bestAddress</span></span>
<span class="line"><span style="color: #F78C6C">WHERE</span><span style="color: #BABED8"> municipality_id </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">25117</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> street_id </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">7705267</span></span>
<span class="line"><span style="color: #F78C6C">GROUP BY</span><span style="color: #BABED8"> all;</span></span></code></pre>
</div><table>
<thead>
<tr>
<th>default_postname</th>
<th style="text-align:right">address_count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chastre</td>
<td style="text-align:right">32</td>
</tr>
<tr>
<td>Villeroux</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>We conclude that each address on the same street can have multiple postnames.</p>
<h2 id="takeaways-from-the-analysis" tabindex="-1">Takeaways from the analysis <a class="header-anchor" href="#takeaways-from-the-analysis" aria-label="Permalink to &quot;Takeaways from the analysis&quot;">&ZeroWidthSpace;</a></h2>
<ImageCenter src="https://raw.githubusercontent.com/tintamarre/tintamarre.github.io/refs/heads/master/src/assets/diagrams/best_address_model.drawio.png" alt="Let's check the data" width="800" /><ul>
<li>The <code>postcode</code> can be associated with multiple <code>municipality_id</code> values and a <code>municipality_id</code> can be associated with multiple <code>postcode</code> values. The relationship between postcodes and municipalities is then a <strong>many-to-many relationship</strong>.</li>
<li>The <code>municipality_id</code> is unique in the dataset, which is mean that a municipality is unique in each region and is not shared between regions.</li>
<li>The <code>address_id</code> is unique in each dataset but is not unique throughout the three datasets. A same <code>address_id</code> can be found in multiple regions.</li>
<li>The <code>street_id</code> shows that a street can be shared between multiple municipalities and that a municipality can have multiple streets. The relationship between streets and municipalities is then a <strong>many-to-many relationship</strong>.</li>
<li>Postname are not unique for a street. A single street can have multiple postnames. We will consider the <code>postname_*</code> as an attribute of the address and not as a key.</li>
</ul>
<h3 id="references" tabindex="-1">Références <a class="header-anchor" href="#references" aria-label="Permalink to &quot;Références&quot;">&ZeroWidthSpace;</a></h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/NIS_code" target="_blank" rel="noreferrer">NIS codes</a></li>
<li><a href="https://www.smalsresearch.be/pourquoi-une-adresse-belge-cest-complique/" target="_blank" rel="noreferrer">Pourquoi une adresse belge, c'est compliqué ?</a></li>
<li><a href="https://bosa.belgium.be/fr/services/best-address-services" target="_blank" rel="noreferrer">BOSA - BeStAddress</a></li>
</ul>
<!-- Next steps: [Address lookup - Part 2 - Sourcing](/blog/posts/drafts/address_lookup-part2-sourcing) -->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Hello World]]></title>
            <link>localhost/blog/blog/posts/2024/hello_world.html</link>
            <guid>localhost/blog/blog/posts/2024/hello_world.html</guid>
            <pubDate>Sat, 21 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[<h3 id="executive-summary" tabindex="-1">Executive summary <a class="header-anchor" href="#executive-summary" aria-label="Permalink to &quot;Executive summary&quot;">&ZeroWidthSpace;</a></h3>
<p>I have been thinking about it for a while, and I finally decided to start writing about my work and my interests. I will try to post regularly, but I am not sure I will be able to keep up with it. We will see.</p>
]]></description>
            <content:encoded><![CDATA[<h3 id="executive-summary" tabindex="-1">Executive summary <a class="header-anchor" href="#executive-summary" aria-label="Permalink to &quot;Executive summary&quot;">&ZeroWidthSpace;</a></h3>
<p>I have been thinking about it for a while, and I finally decided to start writing about my work and my interests. I will try to post regularly, but I am not sure I will be able to keep up with it. We will see.</p>
<hr>
<div class="tip custom-block"><p class="custom-block-title">TIP</p>
<p>The views expressed on this website are my own and do not necessarily reflect the views of my employer.</p>
</div>
]]></content:encoded>
        </item>
    </channel>
</rss>