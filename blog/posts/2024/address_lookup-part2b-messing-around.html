<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Address lookup - Part 2b: Messing around | Tintamarre</title>
    <meta name="description" content="Personal blog of Martin Erpicum">
    <link rel="preload stylesheet" href="/assets/style.ec987d07.css" as="style">
    <script type="module" src="/assets/app.ca10f9d6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/assets/chunks/framework.4bfe0024.js">
  <link rel="modulepreload" href="/assets/chunks/theme.a1eac662.js">
  <link rel="modulepreload" href="/assets/blog_posts_2024_address_lookup-part2b-messing-around.md.13c52e5f.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-56839c3d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-9eb42e17></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-9eb42e17> Skip to content </a><!--]--><!----><header class="VPNav" data-v-56839c3d data-v-8246f099><div class="VPNavBar" data-v-8246f099 data-v-70adf6b5><div class="container" data-v-70adf6b5><div class="title" data-v-70adf6b5><div class="VPNavBarTitle" data-v-70adf6b5 data-v-8e118abc><a class="title" href="/" data-v-8e118abc><!--[--><!--]--><!----><!--[-->Tintamarre<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-70adf6b5><div class="curtain" data-v-70adf6b5></div><div class="content-body" data-v-70adf6b5><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-70adf6b5><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70adf6b5 data-v-1419bb5f><span id="main-nav-aria-label" class="visually-hidden" data-v-1419bb5f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-1419bb5f data-v-58627f5e data-v-390ea14c><!--[-->Home<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-1419bb5f data-v-37dff3b8><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-37dff3b8><span class="text" data-v-37dff3b8><!----> Blog <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-37dff3b8><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-37dff3b8><div class="VPMenu" data-v-37dff3b8 data-v-4f471a21><div class="items" data-v-4f471a21><!--[--><!--[--><div class="VPMenuLink" data-v-4f471a21 data-v-f41bc5f1><a class="VPLink link" href="/blog/" data-v-f41bc5f1 data-v-390ea14c><!--[-->Blog Home<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-4f471a21 data-v-f41bc5f1><a class="VPLink link" href="/blog/tags.html" data-v-f41bc5f1 data-v-390ea14c><!--[-->Tags<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-4f471a21 data-v-f41bc5f1><a class="VPLink link" href="/blog/archives.html" data-v-f41bc5f1 data-v-390ea14c><!--[-->Archives<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-70adf6b5 data-v-7a8f8935><label title="toggle dark mode" data-v-7a8f8935 data-v-b6ab651e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-b6ab651e data-v-c8b4d4cf><span class="check" data-v-c8b4d4cf><span class="icon" data-v-c8b4d4cf><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-b6ab651e><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-b6ab651e><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-70adf6b5 data-v-7d9f08cb data-v-37dff3b8><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-37dff3b8><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-37dff3b8><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-37dff3b8><div class="VPMenu" data-v-37dff3b8 data-v-4f471a21><!----><!--[--><!--[--><!----><div class="group" data-v-7d9f08cb><div class="item appearance" data-v-7d9f08cb><p class="label" data-v-7d9f08cb>Appearance</p><div class="appearance-action" data-v-7d9f08cb><label title="toggle dark mode" data-v-7d9f08cb data-v-b6ab651e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-b6ab651e data-v-c8b4d4cf><span class="check" data-v-c8b4d4cf><span class="icon" data-v-c8b4d4cf><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-b6ab651e><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-b6ab651e><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70adf6b5 data-v-cba97204><span class="container" data-v-cba97204><span class="top" data-v-cba97204></span><span class="middle" data-v-cba97204></span><span class="bottom" data-v-cba97204></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-56839c3d data-v-049ec038><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-049ec038 data-v-f8751f8e><button data-v-f8751f8e>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-v-56839c3d data-v-baf0af1a><div class="VPDoc has-aside" data-v-baf0af1a data-v-abdcb82b><!--[--><!--]--><div class="container" data-v-abdcb82b><div class="left-aside aside" data-v-abdcb82b><div class="aside-curtain" data-v-abdcb82b></div><div class="aside-container" data-v-abdcb82b><div class="aside-content" data-v-abdcb82b><div class="VPDocAside" data-v-abdcb82b data-v-7dd2b804><!--[--><!--[--><!--[--><!--[--><!--[--><span class="bg-primary-100 inline-flex items-center rounded text-sm font-medium"><div data-v-262d93ff><!----><span data-v-262d93ff>Exploration</span></div></span><span class="bg-primary-100 inline-flex rounded text-sm font-medium"><div class="flex flex-wrap gap-2 py-5"><!--[--><a class="rounded-sm bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-600" href="/blog/tags?init=data"><!----> data</a><a class="rounded-sm bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-600" href="/blog/tags?init=exploration"><!----> exploration</a><!--]--></div></span><dl class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 dark:xl:border-slate-200/5" data-v-f51709bc><dt class="sr-only" data-v-f51709bc>Authors</dt><dd data-v-f51709bc><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8" data-v-f51709bc><li class="flex items-center space-x-2" data-v-f51709bc><img src="https://gravatar.com/avatar/4f70a53dd35d6ef71c47711614e1b40a" alt="author image" class="h-10 w-10 rounded-full" data-v-f51709bc><dl class="whitespace-nowrap text-sm font-medium leading-5" data-v-f51709bc><dt class="sr-only" data-v-f51709bc>Name</dt><dd class="text-gray-900 dark:text-white" data-v-f51709bc><a href="/blog/authors/martin-erpicum.html" class="text-lg text-gray-900 hover:text-[color:var(--vp-c-brand-light)] dark:text-white dark:hover:text-[color:var(--vp-c-brand-dark)]" data-v-f51709bc>Martin Erpicum</a></dd><dt class="sr-only" data-v-f51709bc>Twitter</dt><dd data-v-f51709bc><a href="https://twitter.com/@tintamarre" target="_blank" rel="noopener noreferrer" data-v-f51709bc>@tintamarre</a></dd></dl></li></ul></dd></dl><!--]--><!--]--><!--]--><!--]--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-7dd2b804 data-v-a96026ac><div class="content" data-v-a96026ac><div class="outline-marker" data-v-a96026ac></div><div class="outline-title" data-v-a96026ac>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-a96026ac><span class="visually-hidden" id="doc-outline-aria-label" data-v-a96026ac> Table of Contents for current page </span><ul class="root" data-v-a96026ac data-v-f60dfdf1><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-7dd2b804></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--[--><!--[--><!--[--><footer class="mb-24 divide-y divide-gray-200 text-sm font-medium leading-5 dark:divide-slate-200/5" data-v-2f3a5683><div class="py-3" data-v-2f3a5683><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-white" data-v-2f3a5683> Next Article </h2><div class="link" data-v-2f3a5683><a href="/blog/posts/2025/how-to-reuse-a-calendar.html" data-v-2f3a5683>Comment savoir si on peut réutiliser un calendrier pour une année donnée en SQL ?</a></div></div><div class="py-3" data-v-2f3a5683><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-white" data-v-2f3a5683> Previous Article </h2><div class="link" data-v-2f3a5683><a href="/blog/posts/2024/address_lookup-part2-sourcing.html" data-v-2f3a5683>Address lookup - Part 2 - Sourcing</a></div></div><div class="pt-3" data-v-2f3a5683><a class="link" href="/blog/" data-v-2f3a5683>← Back to the blog</a></div></footer><!----><!--]--><!--]--><!--]--><!--]--></div></div></div></div><div class="content" data-v-abdcb82b><div class="content-container" data-v-abdcb82b><!--[--><!--[--><!--[--><!--[--><header class="space-y-1 pt-6 text-center xl:pb-10"><dl><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-300"><time datetime="2024-12-03T12:00:00.000Z">December 3, 2024</time></dd></dl><h1 class="md:leading-14 text-3xl font-extrabold leading-9 tracking-tight text-[color:var(--vp-c-brand-dark)] dark:text-[color:var(--vp-c-brand-light)] sm:text-4xl sm:leading-10 md:text-5xl">Address lookup - Part 2b: Messing around</h1></header><!--[--><div class="xs:show xl:hidden flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><span class="bg-primary-100 inline-flex items-center rounded text-sm font-medium"><div data-v-262d93ff><!----><span data-v-262d93ff>Exploration</span></div></span></div><dl class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 dark:xl:border-slate-200/5 xs:show xl:hidden" data-v-f51709bc><dt class="sr-only" data-v-f51709bc>Authors</dt><dd data-v-f51709bc><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8" data-v-f51709bc><li class="flex items-center space-x-2" data-v-f51709bc><img src="https://gravatar.com/avatar/4f70a53dd35d6ef71c47711614e1b40a" alt="author image" class="h-10 w-10 rounded-full" data-v-f51709bc><dl class="whitespace-nowrap text-sm font-medium leading-5" data-v-f51709bc><dt class="sr-only" data-v-f51709bc>Name</dt><dd class="text-gray-900 dark:text-white" data-v-f51709bc><a href="/blog/authors/martin-erpicum.html" class="text-lg text-gray-900 hover:text-[color:var(--vp-c-brand-light)] dark:text-white dark:hover:text-[color:var(--vp-c-brand-dark)]" data-v-f51709bc>Martin Erpicum</a></dd><dt class="sr-only" data-v-f51709bc>Twitter</dt><dd data-v-f51709bc><a href="https://twitter.com/@tintamarre" target="_blank" rel="noopener noreferrer" data-v-f51709bc>@tintamarre</a></dd></dl></li></ul></dd></dl><!--]--><!--]--><!----><!--]--><!--]--><!--]--><!----><main class="main" data-v-abdcb82b><div style="position:relative;" class="vp-doc _blog_posts_2024_address_lookup-part2b-messing-around" data-v-abdcb82b><div><p><em>Executive summary</em>: In Belgium, a collaborative effort between regional and federal authorities has led to the creation of a unified service that aggregates all Belgian addresses into a comprehensive dataset. This dataset is called <a href="https://bosa.belgium.be/fr/services/best-address-services" target="_blank" rel="noreferrer">BeStAddress</a>.</p><hr><h1 id="address-lookup-part-2b-messing-around" tabindex="-1">Address lookup - Part 2b: Messing around <a class="header-anchor" href="#address-lookup-part-2b-messing-around" aria-label="Permalink to &quot;Address lookup - Part 2b: Messing around&quot;">​</a></h1><p>This post is a continuation of the <a href="/blog/posts/2024/address_lookup-part2-sourcing.html">previous post</a> where we have analyzed the data model of the BeStAddress dataset.</p><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>In Belgium, each municipality is responsible for naming its streets. <a href="https://www.ibz.rrn.fgov.be/fileadmin/user_upload/fr/rn/circulaires/BeSt_20201104_F.pdf" target="_blank" rel="noreferrer">Although it is recommended to avoid similar street names</a>, this can sometimes result in two streets within the same municipality having very similar names. In this post, we will explore the <strong>BeStAddress dataset</strong> to identify pairs of streets with similar names that are geographically close to each other.</p><p>To analyse this, we will use the <a href="/blog/posts/2024/address_lookup-part2-sourcing.html">unified table that aggregates all the data from the different regions of Belgium</a> to find pairs of streets with similar names that are close to each other.</p><p>We will proceed in three steps:</p><ol><li>Find the average latitude and longitude of each street in each municipality.</li><li>Calculate the distance between each pair of streets in the same municipality.</li><li>Calculate the Levenshtein distance between the street names of each pair of streets.</li></ol><h2 id="step-1-find-the-average-latitude-and-longitude-of-street-in-each-municipality" tabindex="-1">Step 1: Find the average latitude and longitude of street in each municipality <a class="header-anchor" href="#step-1-find-the-average-latitude-and-longitude-of-street-in-each-municipality" aria-label="Permalink to &quot;Step 1: Find the average latitude and longitude of street in each municipality&quot;">​</a></h2><p>This step will allow us to identify the geographical center of each street in the dataset and then use this information to calculate the distance between pairs of streets.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> averages_by_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">             street_id,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">  )</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets</span></span></code></pre></div><h2 id="step-2-distance-calculation" tabindex="-1">Step 2. Distance Calculation <a class="header-anchor" href="#step-2-distance-calculation" aria-label="Permalink to &quot;Step 2. Distance Calculation&quot;">​</a></h2><p>We will calculate the distance between each pair of streets in the same municipality. We will use the <strong>Haversine formula</strong> to calculate the distance between two points on the Earth&#39;s surface given their latitude and longitude.</p><p>After calculating the distance between each pair of streets, we will filter the results to only include pairs of streets that are less than 5 kilometers apart.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> averages_by_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">             street_id,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> postcode </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">4140</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">-- Filter by municipality_id == Sprimont</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">  ),</span></span>
<span class="line"><span style="color:#BABED8;">combination_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon1,</span></span>
<span class="line"><span style="color:#BABED8;">           b.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets a</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CROSS JOIN</span><span style="color:#BABED8;"> averages_by_streets b</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id, a.street_id) </span><span style="color:#89DDFF;">&lt;&gt;</span><span style="color:#BABED8;"> (b.municipality_id, b.street_id) </span><span style="color:#676E95;font-style:italic;">-- Exclude self-joins</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.municipality_id</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.street_id)</span></span>
<span class="line"><span style="color:#BABED8;">        )  </span><span style="color:#676E95;font-style:italic;">-- Ensure unique pairs</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">distance_calculation </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_2,</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- Haversine Formula</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- 6371 is the radius of the Earth in kilometers</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- RADIANS converts degrees to radians</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">6371</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ASIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SQRT</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lat1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat1)) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2)) </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lon2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lon1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">))) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> combination_streets</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(distance_km, </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> distance_calculation</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> distance_km </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">5</span><span style="color:#BABED8;">;</span></span></code></pre></div><h2 id="step-3-levenshtein-distance-calculation" tabindex="-1">Step 3. Levenshtein Distance Calculation <a class="header-anchor" href="#step-3-levenshtein-distance-calculation" aria-label="Permalink to &quot;Step 3. Levenshtein Distance Calculation&quot;">​</a></h2><p>Finally, we will calculate the Levenshtein distance between the street names of each pair of streets. The Levenshtein distance is a measure of the similarity between two strings. It is defined as the minimum number of single-character edits (insertions, deletions, or substitutions) required to change one string into the other.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> averages_by_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">             street_id,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude,</span></span>
<span class="line"><span style="color:#BABED8;">             </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AVG</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> postcode </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">4140</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">-- Filter by municipality_id == Sprimont</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">  ),</span></span>
<span class="line"><span style="color:#BABED8;">unique_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id,</span></span>
<span class="line"><span style="color:#BABED8;">           default_streetname</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> street_id </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> street_id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> municipality_id </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> ALL</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">combination_streets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat1,</span></span>
<span class="line"><span style="color:#BABED8;">           a.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon1,</span></span>
<span class="line"><span style="color:#BABED8;">           b.municipality_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lat2,</span></span>
<span class="line"><span style="color:#BABED8;">           b.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> lon2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> averages_by_streets a</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CROSS JOIN</span><span style="color:#BABED8;"> averages_by_streets b</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id, a.street_id) </span><span style="color:#89DDFF;">&lt;&gt;</span><span style="color:#BABED8;"> (b.municipality_id, b.street_id) </span><span style="color:#676E95;font-style:italic;">-- Exclude self-joins</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.municipality_id</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.street_id)</span></span>
<span class="line"><span style="color:#BABED8;">        )  </span><span style="color:#676E95;font-style:italic;">-- Ensure unique pairs</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">distance_calculation </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">           municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">           street_id_2,</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- Haversine Formula</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- 6371 is the radius of the Earth in kilometers</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">-- RADIANS converts degrees to radians</span></span>
<span class="line"><span style="color:#BABED8;">           </span><span style="color:#F78C6C;">6371</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ASIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SQRT</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lat1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat1)) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">COS</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lat2)) </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#BABED8;">                                </span><span style="color:#82AAFF;">POWER</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">SIN</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">RADIANS</span><span style="color:#BABED8;">(lon2 </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> lon1) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">), </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">))) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> combination_streets</span></span>
<span class="line"><span style="color:#BABED8;">), combination_with_distances_filtered </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">       municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(distance_km, </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> distance_km</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> distance_calculation</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> distance_km </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">levenstein_distance </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">    street_id_1,</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">    street_id_2,</span></span>
<span class="line"><span style="color:#BABED8;">    distance_km,</span></span>
<span class="line"><span style="color:#BABED8;">    a.default_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> streetname_1,</span></span>
<span class="line"><span style="color:#BABED8;">    b.default_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> streetname_2,</span></span>
<span class="line"><span style="color:#BABED8;">    levenshtein(a.default_streetname, b.default_streetname) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> levenshtein_distance</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> combination_with_distances_filtered</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> unique_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> a</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> municipality_id_1</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> street_id_1</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> unique_streetname </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> b</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> municipality_id_2</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> b.street_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> street_id_2</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> levenstein_distance</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> levenshtein_distance </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> levenshtein_distance </span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#BABED8;"> levenshtein_distance, distance_km;</span></span></code></pre></div><p>That&#39;s it! We have successfully identified pairs of streets with similar names that are geographically close to each other. It is a long query, but it is very powerful and can be used to identify potential issues with street names in the BeStAddress dataset.</p><h2 id="results" tabindex="-1">Results <a class="header-anchor" href="#results" aria-label="Permalink to &quot;Results&quot;">​</a></h2><table><thead><tr><th style="text-align:right;">municipality_id_1</th><th style="text-align:right;">street_id_1</th><th style="text-align:right;">municipality_id_2</th><th style="text-align:right;">street_id_2</th><th style="text-align:right;">distance_km</th><th>streetname_1</th><th>streetname_2</th><th style="text-align:right;">levenshtein_distance</th></tr></thead><tbody><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732983</td><td style="text-align:right;">62100</td><td style="text-align:right;">7732991</td><td style="text-align:right;">4.16</td><td>Rue de Damré</td><td>Rue de Gomzé</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732996</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733018</td><td style="text-align:right;">2.53</td><td>Rue de la Carrière</td><td>Rue de la Sablière</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733062</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733067</td><td style="text-align:right;">0.63</td><td>Rue des Fawes</td><td>Rue des Marets</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733110</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733117</td><td style="text-align:right;">3.48</td><td>Rue du Roua</td><td>Rue du Voué</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732981</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733047</td><td style="text-align:right;">4.02</td><td>Rue de Coreux</td><td>Rue de Theux</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732981</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733042</td><td style="text-align:right;">1.13</td><td>Rue de Coreux</td><td>Rue de Rouvreux</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7732961</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733129</td><td style="text-align:right;">0.27</td><td>Rue Basse Lillé</td><td>Rue Haute Lillé</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733092</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733108</td><td style="text-align:right;">4.55</td><td>Rue du Coq</td><td>Rue du Pont</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733105</td><td style="text-align:right;">62100</td><td style="text-align:right;">7762862</td><td style="text-align:right;">0.33</td><td>Rue du Pahy</td><td>Rue du Parc</td><td style="text-align:right;">2</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733124</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733132</td><td style="text-align:right;">4.37</td><td>Rue Ferreuse</td><td>Rue Houreuse</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733123</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733124</td><td style="text-align:right;">3.9</td><td>Rue Ferrer</td><td>Rue Ferreuse</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733081</td><td style="text-align:right;">62100</td><td style="text-align:right;">7762862</td><td style="text-align:right;">2.6</td><td>Rue du Baron</td><td>Rue du Parc</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733083</td><td style="text-align:right;">62100</td><td style="text-align:right;">7762862</td><td style="text-align:right;">1.66</td><td>Rue du Baty</td><td>Rue du Parc</td><td style="text-align:right;">3</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733083</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733105</td><td style="text-align:right;">1.99</td><td>Rue du Baty</td><td>Rue du Pahy</td><td style="text-align:right;">2</td></tr><tr><td style="text-align:right;">62100</td><td style="text-align:right;">7733081</td><td style="text-align:right;">62100</td><td style="text-align:right;">7733083</td><td style="text-align:right;">3.85</td><td>Rue du Baron</td><td>Rue du Baty</td><td style="text-align:right;">3</td></tr></tbody></table><h2 id="further-exploration" tabindex="-1">Further exploration <a class="header-anchor" href="#further-exploration" aria-label="Permalink to &quot;Further exploration&quot;">​</a></h2><div align="center" class=""><img src="https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExZTZ6NW5nbXU2Z3hudGszMDljM2lodjR3bHJyZ3Zva3VvZTF5Z3ZqYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/KEXq9JVp3OyZmxZw0W/giphy.gif" alt="Further exploration" width="800" class="rounded object-cover"><div class="inline-flex items-center"><span class="text-gray-600 dark:text-gray-400">Further exploration</span></div></div><p>This dataset is rich in information and can be used to answer a wide range of questions. Here are a few examples of other queries that can be run on the BeStAddress dataset:</p><h3 id="finding-all-unique-combinations-of-two-different-street-id-within-the-same-municipality-id" tabindex="-1">Finding all unique combinations of two different street_id within the same municipality_id <a class="header-anchor" href="#finding-all-unique-combinations-of-two-different-street-id-within-the-same-municipality-id" aria-label="Permalink to &quot;Finding all unique combinations of two different street_id within the same municipality_id&quot;">​</a></h3><p>To retrieve all unique combinations of two different street IDs within the same municipality_id from a SQL database, you can use a self-join. A self-join allows you to pair rows from the same table where certain conditions are met (in this case, two differents street IDs but the same municipality ID).</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">        municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">        street_id,</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">avg</span><span style="color:#BABED8;">(latitude), </span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> latitude, </span><span style="color:#676E95;font-style:italic;">-- Round to 3 decimal places (= ~110 meters)</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">round</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">avg</span><span style="color:#BABED8;">(longitude), </span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> longitude</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">        bestAddress</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">GROUP BY</span></span>
<span class="line"><span style="color:#BABED8;">        municipality_id, street_id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">    a.municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">    a.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> first_street_id,</span></span>
<span class="line"><span style="color:#BABED8;">    b.street_id </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> second_street_id,</span></span>
<span class="line"><span style="color:#BABED8;">    a.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> first_street_latitude,</span></span>
<span class="line"><span style="color:#BABED8;">    a.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> first_street_longitude,</span></span>
<span class="line"><span style="color:#BABED8;">    b.latitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> second_street_latitude,</span></span>
<span class="line"><span style="color:#BABED8;">    b.longitude </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> second_street_longitude</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">    DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> a</span></span>
<span class="line"><span style="color:#F78C6C;">JOIN</span></span>
<span class="line"><span style="color:#BABED8;">    DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> b</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> a.municipality_id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> b.municipality_id </span><span style="color:#676E95;font-style:italic;">-- Same municipality</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F78C6C;">AND</span><span style="color:#BABED8;"> a.street_id </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> b.street_id </span><span style="color:#676E95;font-style:italic;">-- Ensure different street ids and avoid duplicate combinations (like (1, 2) and (2, 1))</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span></span>
<span class="line"><span style="color:#BABED8;">    a.municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">    a.street_id,</span></span>
<span class="line"><span style="color:#BABED8;">    b.street_id</span></span>
<span class="line"><span style="color:#F78C6C;">LIMIT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">;</span></span></code></pre></div><h3 id="percentage-of-non-null-streetname-fr-streetname-de-and-streetname-nl-per-municipality" tabindex="-1">Percentage of non-NULL streetname_fr, streetname_de, and streetname_nl per municipality <a class="header-anchor" href="#percentage-of-non-null-streetname-fr-streetname-de-and-streetname-nl-per-municipality" aria-label="Permalink to &quot;Percentage of non-NULL streetname_fr, streetname_de, and streetname_nl per municipality&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F78C6C;">DISTINCT</span><span style="color:#BABED8;"> municipality_id, street_id, streetname_fr, streetname_de, streetname_nl</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">        BestAddress</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> total_streets,  </span><span style="color:#676E95;font-style:italic;">-- Total number of distinct streets per municipality</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">-- Percentage of non-NULL streetname_fr</span></span>
<span class="line"><span style="color:#BABED8;">    (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_fr </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_fr,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">-- Percentage of non-NULL streetname_de</span></span>
<span class="line"><span style="color:#BABED8;">    (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_de </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_de,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">-- Percentage of non-NULL streetname_nl</span></span>
<span class="line"><span style="color:#BABED8;">    (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_nl </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_nl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">    DistinctStreets</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span></span>
<span class="line"><span style="color:#BABED8;">    municipality_id;</span></span></code></pre></div><h3 id="percentage-of-non-null-streetname-fr-streetname-de-and-streetname-nl-per-municipality-excluding-municipalities-where-any-of-the-streetname-percentages-are-0-or-100" tabindex="-1">Percentage of non-NULL streetname_fr, streetname_de, and streetname_nl per municipality, excluding municipalities where any of the streetname percentages are 0 or 100 <a class="header-anchor" href="#percentage-of-non-null-streetname-fr-streetname-de-and-streetname-nl-per-municipality-excluding-municipalities-where-any-of-the-streetname-percentages-are-0-or-100" aria-label="Permalink to &quot;Percentage of non-NULL streetname_fr, streetname_de, and streetname_nl per municipality, excluding municipalities where any of the streetname percentages are 0 or 100&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> DistinctStreets </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F78C6C;">DISTINCT</span><span style="color:#BABED8;"> municipality_id, street_id, streetname_fr, streetname_de, streetname_nl, region_code</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">          BestAddress</span></span>
<span class="line"><span style="color:#BABED8;">  )</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">      municipality_id,</span></span>
<span class="line"><span style="color:#BABED8;">      region_code,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> total_streets,  </span><span style="color:#676E95;font-style:italic;">-- Total number of distinct streets per municipality</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">-- Percentage of non-NULL streetname_fr</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_fr </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_fr,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">-- Percentage of non-NULL streetname_de</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_de </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_de,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">-- Percentage of non-NULL streetname_nl</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_nl </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> pct_streetname_nl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#BABED8;">      DistinctStreets</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">GROUP BY</span></span>
<span class="line"><span style="color:#BABED8;">      municipality_id, region_code</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">HAVING</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">-- Filter municipalities where any of the streetname percentages are not 0 or 100</span></span>
<span class="line"><span style="color:#BABED8;">      (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_fr </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_de </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F78C6C;">OR</span><span style="color:#BABED8;"> (</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">CASE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">WHEN</span><span style="color:#BABED8;"> streetname_nl </span><span style="color:#F78C6C;">IS NOT NULL</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">THEN</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">END</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">CAST</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">COUNT</span><span style="color:#BABED8;">(street_id) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">FLOAT</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">ORDER BY</span></span>
<span class="line"><span style="color:#BABED8;">      region_code;</span></span></code></pre></div></div></div></main><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-56839c3d data-v-9d18c063><div class="container" data-v-9d18c063><p class="message" data-v-9d18c063>Made with ❤️</p><p class="copyright" data-v-9d18c063>WTFPL License | <a href="https://github.com/tintamarre/tintamarre.github.io">Source code</a></p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_posts_2024_hello_world.md\":\"5197f3c3\",\"blog__partials_basics.md\":\"526572f6\",\"blog_index.md\":\"795fd32b\",\"blog_posts_2024_address_lookup-part2b-messing-around.md\":\"13c52e5f\",\"theme-test.md\":\"6c5d79e4\",\"blog_posts_2024_tax_brackets_proposition.md\":\"0a0e37f5\",\"index.md\":\"3a593856\",\"blog_archives.md\":\"4f60f923\",\"blog_authors_martin-erpicum.md\":\"0a76c6c9\",\"assets_datasets_bestaddress_bxl.md\":\"66a1ace2\",\"blog_posts_2025_how-to-reuse-a-calendar.md\":\"40783bf7\",\"blog_posts_2024_address_lookup-part2-sourcing.md\":\"7320eea0\",\"assets_datasets_bestaddress_vld.md\":\"81b76668\",\"assets_datasets_bestaddress_wal.md\":\"154ceb5f\",\"blog_tags.md\":\"029d5e0f\",\"blog_posts_2024_address_lookup-part1-problematic.md\":\"f8317f05\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Tintamarre\",\"description\":\"Personal blog of Martin Erpicum\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"title\":\"\",\"description\":\"Some thoughts\",\"defaultAuthor\":\"Martin Erpicum\",\"categoryIcons\":{\"article\":\"i-[heroicons-outline/book-open]\",\"tutorial\":\"i-[heroicons-outline/academic-cap]\",\"document\":\"i-[heroicons-outline/annotation]\",\"experimentation\":\"i-[heroicons-outline/beaker]\"},\"tagIcons\":{\"github\":\"i-[carbon/logo-github]\",\"vue\":\"i-[carbon/logo-vue]\"}},\"footer\":{\"message\":\"Made with ❤️\",\"copyright\":\"WTFPL License | <a href=\\\"https://github.com/tintamarre/tintamarre.github.io\\\">Source code</a>\"},\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Blog\",\"items\":[{\"text\":\"Blog Home\",\"link\":\"/blog/\",\"activeMatch\":\"/blog/$\"},{\"text\":\"Tags\",\"link\":\"/blog/tags\",\"activeMatch\":\"/blog/tags\"},{\"text\":\"Archives\",\"link\":\"/blog/archives\",\"activeMatch\":\"/blog/archives\"}]}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>